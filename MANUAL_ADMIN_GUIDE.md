# Manual Admin Account Creation Guide

If the automatic methods are not working for you, follow these step-by-step instructions to manually create or fix your Admin account.

## Method 1: The "Force Fix" Script (Recommended)

I have created a special script that bypasses the common issues. Use this to force-reset the admin account.

1.  **Stop your running server** (Ctrl+C in your terminal).
2.  **Run the script:**
    ```powershell
    node scripts/force-create-admin.js
    ```
3.  **Check the Output:**
    - Look for: `SUCCESS: Admin account ready.`
    - Note the credentials displayed.
4.  **Restart your server:**
    ```powershell
    npm run dev
    ```
5.  **Login:**
    - Go to: `http://localhost:9002/sign-in`
    - Email: `admin@hiigsi.com`
    - Password: `Admin@123456`

---

## Method 2: Create via API (If Server is Running)

If your server is running (`npm run dev`), you can use the secure registration endpoint I added.

1.  **Open your browser** to `http://localhost:9002`.
2.  **Open Developer Tools** (Press F12).
3.  **Go to the "Console" tab.**
4.  **Paste this code and press Enter:**

    ```javascript
    fetch('/api/auth/admin-register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: 'myadmin@hiigsi.com',          // You can choose a custom email
        password: 'MySecretPassword123!',     // Choose a custom password
        firstName: 'Master',
        lastName: 'Admin',
        secretKey: 'your-super-secret-admin-key-change-in-production' // Must match .env
      })
    })
    .then(res => res.json())
    .then(data => console.log(data));
    ```

5.  **Check the result:**
    - If successful, it will print: `{ success: true, ... }`
    - You can now login with the email and password you just set.

---

## Method 3: Manual SQL Database Insertion (Advanced)

If you prefer to work directly with the database (e.g., via Neon Console or a SQL client), run these SQL commands.

**Prerequisites:**
- You need to generate a bcrypt hash for your password.
- Hash for `Admin@123456`: `$2a$12$L8UserPasswordHash...` (Use an online bcrypt generator or the script below to get a valid hash).
- *Better yet, use Method 1 as it handles hashing for you.*

**SQL Commands:**

```sql
-- 1. Ensure Admin Role Exists
INSERT INTO "Role" (id, name, description, "createdAt", "updatedAt")
VALUES ('role_admin_fixed', 'Admin', 'System Administrator', NOW(), NOW())
ON CONFLICT (name) DO NOTHING;

-- 2. Create/Update Admin User (Password: Admin@123456)
-- Hash: $2b$12$1.2.3.4.5.6.7.8.9.0.1.2.3.4.5.6.7.8.9.0.1.2.3.4.5.6.7.8.9
-- Note: Replace the hash below with a real one generated by bcrypt
INSERT INTO "User" (id, "firstName", "lastName", email, "passwordHash", status, "isActive", "createdAt", "updatedAt")
VALUES (
    'user_admin_fixed', 
    'Super', 
    'Admin', 
    'admin@hiigsi.com', 
    '$2a$12$WvJ.hQ.9.O.Z1.2.3.4.5.6.7.8.9.0.1.2.3.4.5.6.7.8.9.0', -- REPLACE WITH REAL HASH
    'ACTIVE', 
    true, 
    NOW(), 
    NOW()
)
ON CONFLICT (email) 
DO UPDATE SET 
    "passwordHash" = EXCLUDED."passwordHash",
    status = 'ACTIVE', 
    "isActive" = true;

-- 3. Assign Role
INSERT INTO "UserRole" (id, "userId", "roleId")
SELECT 'ur_admin_fixed', u.id, r.id
FROM "User" u, "Role" r
WHERE u.email = 'admin@hiigsi.com' AND r.name = 'Admin'
ON CONFLICT DO NOTHING;
```

---

## Verifying Success

1.  **Login Test:**
    Try logging in at `/sign-in`.
    
2.  **Token Check:**
    If you are redirected to `/dashboard` instead of `/dashboard/admin`, checking your cookies (F12 -> Application -> Cookies) for `auth-token`.
    
3.  **Role Check:**
    If you can login but don't see Admin features, your user might exist but lack the "Admin" role linkage. Run Method 1 again to fix the linkage.
